<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>EXPERIMENT</title>
    <style media="screen">
      *{
        margin: 0;
        padding: 0;
        /* font-family: sans-serif; */
        font-family: 'Courier New', monospace;
      }
    </style>
    <link rel="stylesheet" href="./stylesheet.css">
    <link rel="stylesheet" href="./style-amended.css">
  </head>
  <body>
    <header class="site-header" data-context="theme.topcontainer" data-hover-hint="header">
        <div class="logo-wrap" data-hover-hint="logo">
              <div class="logo">
                <a id="home-link" href="./index.html?position=1">
                <svg xmlns="http://www.w3.org/2000/svg" width="300px" viewBox="0 0 98.4533 46.3838"><defs><style>.a{font-size:12px;fill:#231815;font-family:CourierNewPSMT, Courier New;}.b{letter-spacing:0.1757em;}.c{letter-spacing:0.198em;}.d{letter-spacing:0.6673em;}.e{letter-spacing:-0.0151em;}</style></defs><text class="a" transform="translate(0.0004 9.4276)"><tspan class="b">TOWARD</tspan><tspan x="55.855" y="0">S</tspan><tspan class="c" x="63.0562" y="0"> </tspan><tspan class="b" x="72.6338" y="0">TH</tspan><tspan x="91.252" y="0">E</tspan><tspan class="d" x="0" y="14.3999">DIGITA</tspan><tspan x="91.252" y="14.3999">L</tspan><tspan class="e" x="0" y="28.7998">ARCHITECTONIC</tspan><tspan x="91.252" y="28.7998">S</tspan></text></svg>
                    <!-- <a href="./index.html" class="preserve-whitespace" style="color: #404040">TOWARDS THE DIGITAL ARCHITECTONIC</a> -->
                </a>
              </div>
        </div>
    </header>
    <script type="text/javascript" src="./checkhomeaddress.js"></script>

    <!-- load tensorflow js -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script> -->
    <script src="./anarchdailylexicon_full/data/tfjs/tf.min.js"></script>

    <div class="project-container-wrapper">
      <div id="project-container" class="project-container">
        <!-- <section class="project-covers" data-context="page.gallery.covers"> -->
          <div class="project-title">
            Experiment
          </div>

          <div class="project-text-centered">
            <p>This is an experimental page for running pre-trained neural network models in javascript.</p>
          </div>

          <div class="project-text-centered">
            <!-- crossorigin attribute is essential -->
            <img id="img" crossorigin='anonymous' src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Cat03.jpg" width="100%"></img>
          </div>

          <div class="project-text-centered"><p>check results in console</p></div>

          <div class="project-text-centered">-</div>
        <!-- </section> -->
      </div>
    </div>

    <script type="module">
      const IMAGE_SIZE=224;
      // import * as tf from '@tensorflow/tfjs';

      // loading from google cloud storage (CORS config is needed for the google clound storage, see https://cloud.google.com/storage/docs/configuring-cors)
      // const model = await tf.loadLayersModel('https://storage.googleapis.com/zfguo_pretrained_models/mobilenet/model.json');

      // loading from self (mobilenet is light, thus making this possible)
      const model = await tf.loadLayersModel('./anarchdailylexicon_full/data/mobilenet/model.json');

      console.log("finished loading");
      console.log(model);

      // check https://github.com/tensorflow/tfjs-models/blob/master/mobilenet/src/index.ts function infer() on how to convert img to tf.Tensor
      let img = document.getElementById('img');
      if (!(img instanceof tf.Tensor)) {
        img = tf.browser.fromPixels(img);
      }
      // normalization
      let normalized=img;

      // resize and reshape
      let resized = normalized;
      if (img.shape[0] !== IMAGE_SIZE || img.shape[1] !== IMAGE_SIZE) {
        const alignCorners = true;
        resized = tf.image.resizeBilinear(
            normalized, [IMAGE_SIZE, IMAGE_SIZE], alignCorners);
      }

      const batched = tf.reshape(resized, [-1, IMAGE_SIZE, IMAGE_SIZE, 3]);

      let pred = await model.predict(tf.randomNormal([3, 224, 224, 3]));
      console.log("RANDOM",pred);
      pred = await model.predict(batched);
      console.log("IMG",pred);
      console.log(pred.dataSync());
    </script>
  </body>
</html>
